Version 4
SHEET 1 5428 2404
WIRE 3840 -16 3696 -16
WIRE 3984 -16 3840 -16
WIRE 4048 -16 3984 -16
WIRE 4144 -16 4048 -16
WIRE 4304 -16 4224 -16
WIRE 3840 64 3840 -16
WIRE 3984 64 3984 -16
WIRE 3808 96 3696 96
WIRE 3840 192 3840 128
WIRE 3840 192 3696 192
WIRE 3840 208 3840 192
WIRE 3984 208 3984 128
WIRE 3808 528 3808 512
WIRE -48 592 -48 544
WIRE 448 624 448 608
WIRE 1136 624 1136 608
WIRE 2096 624 2096 608
WIRE 3296 640 3296 576
WIRE 3488 640 3296 640
WIRE 3808 640 3808 608
WIRE 4304 640 4304 576
WIRE 4304 640 3808 640
WIRE 4496 640 4304 640
WIRE 4656 640 4496 640
WIRE 4720 640 4656 640
WIRE 4816 640 4720 640
WIRE 4976 640 4896 640
WIRE 3488 688 3488 640
WIRE 3808 688 3808 640
WIRE 3296 704 3296 640
WIRE 3264 720 3184 720
WIRE 4656 720 4656 640
WIRE 448 736 448 704
WIRE 592 736 448 736
WIRE 736 736 592 736
WIRE 800 736 736 736
WIRE 1136 736 1136 704
WIRE 1280 736 1136 736
WIRE 1424 736 1280 736
WIRE 1488 736 1424 736
WIRE 1584 736 1488 736
WIRE 1744 736 1664 736
WIRE 2096 736 2096 704
WIRE 2240 736 2096 736
WIRE 2384 736 2240 736
WIRE 2448 736 2384 736
WIRE 2544 736 2448 736
WIRE 2704 736 2624 736
WIRE 3424 736 3328 736
WIRE 1280 752 1280 736
WIRE 2096 752 2096 736
WIRE 3264 752 3184 752
WIRE 4496 752 4496 640
WIRE 4304 768 4304 640
WIRE 3184 784 3184 752
WIRE 3808 784 3808 768
WIRE 4192 784 3808 784
WIRE 4272 784 4192 784
WIRE 3808 800 3808 784
WIRE 4432 800 4336 800
WIRE 448 816 448 736
WIRE 736 816 736 736
WIRE 1136 816 1136 736
WIRE 1424 816 1424 736
WIRE 2240 816 2240 736
WIRE 2384 816 2384 736
WIRE 4272 816 4192 816
WIRE 5360 832 5360 816
WIRE 592 848 592 736
WIRE 592 848 480 848
WIRE 1280 848 1280 832
WIRE 1280 848 1168 848
WIRE 2096 848 2096 832
WIRE 2208 848 2096 848
WIRE 4192 848 4192 816
WIRE 592 864 592 848
WIRE 1280 864 1280 848
WIRE 2096 864 2096 848
WIRE 4656 864 4656 784
WIRE 3184 896 3184 864
WIRE 3296 896 3296 768
WIRE 3296 896 3184 896
WIRE 3488 896 3488 784
WIRE 3488 896 3296 896
WIRE -304 928 -304 912
WIRE 2240 944 2240 880
WIRE 2240 944 2096 944
WIRE 448 960 448 880
WIRE 592 960 592 944
WIRE 736 960 736 880
WIRE 1136 960 1136 880
WIRE 1280 960 1280 944
WIRE 1424 960 1424 880
WIRE 2096 960 2096 944
WIRE 2240 960 2240 944
WIRE 2384 960 2384 880
WIRE 3808 960 3808 880
WIRE 4192 960 4192 928
WIRE 4192 960 3808 960
WIRE 4304 960 4304 832
WIRE 4304 960 4192 960
WIRE 4320 960 4304 960
WIRE 4496 960 4496 848
WIRE 4496 960 4320 960
WIRE 5360 960 5360 912
WIRE 3296 976 3296 896
WIRE 4304 1040 4304 960
WIRE -304 1056 -304 1008
WIRE -304 1056 -464 1056
WIRE -464 1152 -464 1136
WIRE -416 1152 -464 1152
WIRE -304 1152 -336 1152
WIRE -464 1184 -464 1152
WIRE -464 1312 -464 1264
WIRE 752 1536 640 1536
WIRE 944 1536 816 1536
WIRE 640 1648 640 1536
WIRE 752 1648 640 1648
WIRE 944 1648 944 1536
WIRE 944 1648 832 1648
WIRE 864 1760 784 1760
WIRE 784 1792 784 1760
WIRE 864 1792 864 1760
WIRE 784 1952 784 1872
WIRE 384 1968 336 1968
WIRE 640 1968 640 1648
WIRE 640 1968 464 1968
WIRE 752 1968 640 1968
WIRE 944 1984 944 1648
WIRE 944 1984 816 1984
WIRE 1168 1984 944 1984
WIRE 752 2000 640 2000
WIRE 336 2032 336 1968
WIRE 640 2032 640 2000
WIRE 944 2064 944 1984
WIRE 784 2096 784 2016
WIRE 1168 2160 1168 1984
WIRE 944 2224 944 2144
WIRE 944 2352 944 2288
WIRE 1168 2352 1168 2224
FLAG 448 528 0
FLAG 592 960 0
FLAG 448 960 0
FLAG 736 960 0
FLAG 800 736 VRef2+
FLAG -48 672 0
FLAG -464 1312 0
FLAG -304 832 0
FLAG -304 1152 test
FLAG 1136 528 0
FLAG 1280 960 0
FLAG 1136 960 0
FLAG 1424 960 0
FLAG 1488 736 VRef2+
FLAG 1744 736 IRef2+
FLAG 2096 528 0
FLAG 2240 960 0
FLAG 2096 960 0
FLAG 2384 960 0
FLAG 2448 736 VRef2+
FLAG 2704 736 IRef2+
FLAG 3184 720 ref
FLAG 3296 576 cathode
FLAG 3296 976 anode
FLAG 4192 784 ref
FLAG 4304 576 cathode
FLAG 3808 432 0
FLAG 3840 208 0
FLAG 3984 208 0
FLAG 4048 -16 VRef2+
FLAG 4304 -16 IRef2+
FLAG 4304 1040 0
FLAG 4320 960 anode
FLAG 4656 864 0
FLAG 4720 640 VRef2+
FLAG 4976 640 IRef2+
FLAG 5360 736 0
FLAG 864 1792 0
FLAG 784 2176 0
FLAG 640 2032 0
FLAG 1168 1984 Vout
FLAG 944 2352 0
FLAG 336 2032 0
FLAG 1168 2352 0
SYMBOL voltage 448 624 R180
WINDOW 0 24 96 Left 2
WINDOW 3 23 21 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 16V
SYMBOL polcap 720 816 R0
SYMATTR InstName C2
SYMATTR Value 47µF
SYMBOL res 432 608 R0
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL res 576 848 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL TL431AS 448 848 M0
SYMATTR InstName X1
SYMBOL voltage -48 576 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 15V
SYMBOL res -64 448 R0
SYMATTR InstName R1
SYMATTR Value 5k
SYMBOL res -480 1168 R0
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL res -480 1040 R0
SYMATTR InstName R3
SYMATTR Value 9k
SYMBOL voltage -304 928 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 15V
SYMBOL res -320 912 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res -432 1168 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R8
SYMATTR Value 5k
SYMBOL voltage 1136 624 R180
WINDOW 0 24 96 Left 2
WINDOW 3 23 21 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 16V
SYMBOL polcap 1408 816 R0
SYMATTR InstName C1
SYMATTR Value 47µF
SYMBOL res 1120 608 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL res 1264 848 R0
SYMATTR InstName R9
SYMATTR Value 9k
SYMBOL TL431AS 1136 848 M0
SYMATTR InstName X2
SYMBOL res 1264 736 R0
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res 1680 720 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 5k
SYMBOL voltage 2096 624 R180
WINDOW 0 24 96 Left 2
WINDOW 3 23 21 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 16V
SYMBOL polcap 2368 816 R0
SYMATTR InstName C3
SYMATTR Value 47µF
SYMBOL res 2080 608 R0
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL res 2080 736 R0
SYMATTR InstName R13
SYMATTR Value 1k
SYMBOL TL431AS 2240 848 R0
SYMATTR InstName X3
SYMBOL res 2080 848 R0
SYMATTR InstName R14
SYMATTR Value 9k
SYMBOL res 2640 720 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 5k
SYMBOL OpAmps\\UniversalOpAmp2 3296 736 M180
SYMATTR InstName U1
SYMBOL voltage 3184 768 R0
WINDOW 0 -67 40 Left 2
WINDOW 3 -76 89 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 2.5V
SYMBOL npn3 3424 688 R0
SYMATTR InstName Q1
SYMBOL OpAmps\\UniversalOpAmp2 4304 800 M180
SYMATTR InstName U2
SYMBOL voltage 4192 832 R0
WINDOW 0 -67 40 Left 2
WINDOW 3 -76 89 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 2.5V
SYMBOL npn3 4432 752 R0
SYMATTR InstName Q2
SYMBOL voltage 3808 528 R180
WINDOW 0 24 96 Left 2
WINDOW 3 23 21 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 16V
SYMBOL polcap 3968 64 R0
SYMATTR InstName C4
SYMATTR Value 47µF
SYMBOL res 3792 512 R0
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 3792 672 R0
SYMATTR InstName R17
SYMATTR Value 5k
SYMBOL TL431AS 3840 96 R0
SYMATTR InstName X4
SYMBOL res 3792 784 R0
SYMATTR InstName R18
SYMATTR Value 5k
SYMBOL res 4240 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 5k
SYMBOL polcap 4640 720 R0
SYMATTR InstName C5
SYMATTR Value 47µF
SYMBOL res 4912 624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 5k
SYMBOL voltage 5360 832 R180
WINDOW 0 24 96 Left 2
WINDOW 3 23 21 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value 16V
SYMBOL res 5344 816 R0
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL OpAmps\\UniversalOpAmp2 784 1984 R0
SYMATTR InstName U3
SYMATTR Value2 Avol=31623 GBW=2Meg Slew=8Meg
SYMATTR SpiceLine Ilimit=4A Rail=0 Vos=1m
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=100k
SYMBOL voltage 784 1888 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value 15V
SYMBOL voltage 784 2192 R180
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 15V
SYMBOL cap 816 1520 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 68p
SYMBOL res 848 1632 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 15k
SYMBOL res 928 2048 R0
SYMATTR InstName R22
SYMATTR Value 10
SYMBOL cap 928 2224 R0
SYMATTR InstName C7
SYMATTR Value 4.7nF
SYMBOL current 464 1968 R90
WINDOW 0 32 40 VTop 2
WINDOW 3 -32 40 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value PULSE(0 1mA 0.1s 0.1s 0.1s 0.1s 0.4s 100)
SYMBOL cap 1152 2160 R0
SYMATTR InstName C8
SYMATTR Value 0.09µF
TEXT 504 1032 Left 2 ;.tran 5s startup
TEXT 512 992 Left 2 ;potentiometer
TEXT 1192 1032 Left 2 ;.tran 5s startup
TEXT 1200 992 Left 2 ;potentiometer
TEXT 2152 1032 Left 2 ;.tran 5s startup
TEXT 2160 992 Left 2 ;potentiometer
TEXT 3752 280 Left 2 !.tran 5s startup
TEXT 3760 240 Left 2 ;potentiometer
TEXT -328 1864 Left 2 ;Invert the current source bcz the DAC current goes in this direction.
